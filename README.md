Episcope - Integrative ATAC-RNA Framework for Condition-Specific Gene Regulatory Networks
===========================================================================================

[![Version](https://img.shields.io/badge/version-1.0.0-blue.svg?style=plastic)](https://github.com/oncologylab/episcope)
[![License](https://img.shields.io/badge/license-MIT-green.svg?style=plastic)](https://github.com/oncologylab/episcope/blob/main/LICENSE)
[![Bioconductor](https://img.shields.io/badge/install%20via-BiocManager-orange.svg?style=plastic)](https://bioconductor.org)
[![Maintenance](https://img.shields.io/badge/Maintained%3F-yes-green.svg?style=plastic)](https://github.com/oncologylab/episcope/graphs/commit-activity)
[![publication](https://img.shields.io/badge/Publication-in%20prep-blue.svg?style=plastic)]()

---

## Introduction

**Episcope** is a modular framework for integrating **chromatin accessibility (ATAC)** and **transcriptomic (RNA-seq)** data to infer condition-specific **TF binding sites (TFBS)**, and reconstruct dynamic **gene regulatory networks (GRNs)**.

It enables users to:
 
- Collapse overlapping, redundant TF motif footprints generated by standard pipelines into **consensus, site- and motif-nonredundant footprint clusters** based on genomic overlap and shared motif composition.
- Infer **condition-specific** canonical and non-canonical TFBS by correlating changes in TF expression with footprint/chromatin accessibility scores across conditions. 
- Refine **regulatory priors** (e.g., GeneHancer, genomic proximity, or user-supplied 3D chromatin interaction data) by filtering **TFâ†’TFBSâ†’gene** links using concordant correlation between *(i)* TF expression and target expression and *(ii)* footprint/chromatin accessibility scores and target expression.  
- Extract active **TFâ†’TFBSâ†’gene regulatory links** within each condition and identify **differential** links between conditions.
- Model dynamic GRNs using **multilayer perception (MLP)** and **variational autoencoder (VAE)**-based topic modeling to learns shared latent topics capturing joint transcriptional and regulatory programs.
- Generate **interactive** visualizations of **topic- and condition-specific GRNs**, along with cross-topic and cross-condition summary plots of pathway enrichment, TF-target clustering, and top master TFs.

---

## Installation

Episcope is an R package available on GitHub.

```r
# Using remotes
remotes::install_github("oncologylab/episcope")

# or using pak
pak::pak("oncologylab/episcope")
```

Dependencies (Bioconductor and CRAN):
```r
install.packages(c("visNetwork", "igraph", "ggplot2", "data.table", "BiocManager"))
BiocManager::install(c("DESeq2", "GenomicRanges", "SummarizedExperiment"))
```

---

## Usage Overview

Episcope runs as a 3-module pipeline and each module contains 2-4 primary functions and optional auxiliary functions:

### [**Module 1: Predict TF Binding Sites (TFBS)**](https://github.com/oncologylab/episcope/wiki/Module-1:-Predict-TF-Binding-Sites-(TFBS))

#### **Primary functions**
- [`load_multiomic_data()`](link) produces a combined multiomic data object from a `*.yaml` configuration file specifying: *(i)* paths to the merged, normalized ATAC master table and normalized RNA-seq master table, *(ii)* the directory containing per-condition TF motif footprint score files generated by TOBIAS or other similar tools, and *(iii)* a metadata table mapping samples to conditions, along with other configuration settings.
- [`correlate_tf_to_fp()`](link) first aligns, collapses and filters overlapping, redundant TF footprints (FPs) into nonredundant consensus footprints, to compute consensus footprint clusters, and performs quantile normalization on the collapsed, non-redundant FPs. It then computes Pearson (linear) and Spearman (rank-based) correlations between TF expression and footprint scores across conditions using the combined multi-omic data object. In *canonical* mode, each TF is correlated only with footprints matching its canonical binding motif(s), whereas in *all* mode, TF expression is correlated with all footprint scores.

#### **Auxiliary functions**
- [`output_per_condition_tfbs_bed_files()`](link)
- [`experimental_benchmarking_of_tfbs_predictions()`](link)

### [**Module 2: Connect TFs to Target Genes**](https://github.com/oncologylab/episcope/wiki/Module-2:-Connect-TFs-to-Target-Genes)

#### **Primary functions**
- [`link_tf_targets()`](link) links TF binding sites (TFBS; from Module 1) to candidate target genes using GeneHancer (default), genomic proximity (e.g., 30kb from TSS), or user-supplied 3D chromatin interaction loops (e.g., Hi-C). The TF->TFBS->target links that pass expression, footprint and peak filters specified in the `*.yaml` configuration file are subjected to sequential pairwise *(i)* Pearson correlations between TF and candidate target expression and *(ii)* Spearman and Pearson correlations between footprint scores (or peak signal if footprints not available) and candidate target expression across all matching conditions, retaining only links that pass correlation cutoffs specified in the `*.yaml` configuration file. 
- [`extract_link_info_by_condition()`](link) generates condition-specific summary tables of TF->TFBS->target links that are active (link_status = 1) in at least one condition. 

#### **Auxiliary functions**
- [`pathway_enrichment_of_tf_targets()`](link)
- [`build_custom_grns()`](link)

### [**Module 3: Learn Regulatory Topics & Visualize Differential GRNs**](https://github.com/oncologylab/episcope/wiki/Module-3:-Learn-Regulatory-Topics-&-Visualize-Differential-GRNs)

#### **Primary functions**
- [`find_differential_links()`](link) performs pairwise comparisons and extracts differential TF->FP->target links based on a user-supplied comparison metadata table. 
- [`train_topic_models()`](link) constructs **perâ€“TF-cluster â€œdocumentsâ€** containing weighted, condition- and direction-specific differential TFâ†’TFBSâ†’target links combining RNA and footprint (or peak) data, fuses the two representations with a **multilayer perception (MLP)**, and learns shared latent topics that capture joint transcriptional and regulatory programs using **variational autoencoder (VAE)** for a series of user-defined k values. 
- [`extract_regulatory_topics()`](link) computes link-topic probabilities and automatically assigns links to topics based on a user-selected k, and generates topic summary plots. 
- [`build_per_comparison_per_topic_differential_grns()`](link) produces interactive visualizations of differential GRNs per condition and per topic.

#### **Auxiliary functions**
- [`run_per_condition_topic_clustering()`](link) 
- [`run_per_condition_topic_pathway_enrichment()`](link) 
- [`build_custom_differential_grns()`](link) 

---

## Pipelines

episcope supports multiple orchestrated pipelines:

- **Snakemake** - scalable, HPC-optimized  
- **Nextflow** - reproducible, cloud-ready  
- **R scripts** - local exploratory runs

ğŸ‘‰ https://github.com/oncologylab/episcope_snakemake  
ğŸ‘‰ https://github.com/oncologylab/episcope_nextflow

---

## Help and Documentation

- ğŸ“˜ Docs https://github.com/oncologylab/episcope/wiki  
- â“ FAQ https://github.com/oncologylab/episcope/wiki/FAQ  
- ğŸ› Bug report https://github.com/oncologylab/episcope/issues

---

## How to Cite

Li, Y., Yi, C. *et al.* (in preparation).  
**Episcope:** Integrative ATAC-RNA framework for condition-specific gene regulatory network analysis.

---

## License

This project is licensed under the [GNU General Public License v3.0](https://github.com/oncologylab/episcope/blob/main/LICENSE.md).
