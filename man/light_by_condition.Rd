% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils_step2_connect_tf_genes.R
\name{light_by_condition}
\alias{light_by_condition}
\title{Build per-condition TF->gene link tables ("lighting") using a chosen sample label column.}
\usage{
light_by_condition(
  ds,
  basal_links,
  out_dir,
  prefix = "lighting",
  label_col = c("strict_match_rna", "cell_stress_type"),
  link_score_threshold = 0,
  fp_score_threshold = 1,
  tf_expr_threshold = 10,
  fp_bound_tbl = NULL,
  rna_expressed_tbl = NULL,
  atac_score_tbl = NULL,
  atac_score_threshold = 0,
  require_atac_score = FALSE,
  fp_annotation_tbl = NULL,
  require_fp_bound = FALSE,
  require_gene_expr = FALSE,
  gene_expr_threshold = 1L,
  filter_active = FALSE,
  use_parallel = TRUE,
  workers = max(1L, round(parallel::detectCores(logical = TRUE)/2)),
  reuse_existing = TRUE,
  verbose = TRUE,
  fp_variance_tbl = NULL,
  rna_variance_tbl = NULL
)
}
\arguments{
\item{ds}{A list containing at least: fp_score (peak_ID + samples), rna (HGNC/ensembl_gene_id + samples),
and sample_metadata_used (must include 'id' and optionally the chosen label column).}

\item{basal_links}{Basal TF->enhancer->gene link table.}

\item{out_dir}{Output directory.}

\item{prefix}{Output file prefix.}

\item{label_col}{Character scalar **or** character vector of candidates. The first that exists in
`ds$sample_metadata_used` will be used; else falls back to `"id"`. Defaults to
c("strict_match_rna","cell_stress_type") for backward-compatibility.}

\item{link_score_threshold}{Numeric threshold on |link_score|.}

\item{fp_score_threshold}{Numeric threshold on fp_score.}

\item{tf_expr_threshold}{Numeric threshold on TF expression.}

\item{fp_bound_tbl}{Optional fp_bound matrix (peak_ID + condition columns; 0/1).}

\item{rna_expressed_tbl}{Optional gene expression flag matrix (HGNC/ensembl + condition columns; 0/1).}

\item{atac_score_tbl}{Optional ATAC score table (atac_peak + condition columns).}

\item{atac_score_threshold}{Numeric threshold on atac_score.}

\item{require_atac_score}{If TRUE, require atac_score >= atac_score_threshold to mark links active.}

\item{fp_annotation_tbl}{Optional fp_annotation table to map peak_ID -> atac_peak when needed.}

\item{require_fp_bound}{If TRUE, require fp_bound > 0 to mark links active.}

\item{require_gene_expr}{If TRUE, require TF and gene expression flags to mark links active.}

\item{gene_expr_threshold}{Threshold for expression flags (default 1).}

\item{filter_active}{If TRUE, write only active links per condition.}

\item{use_parallel}{Whether to parallelize across conditions.}

\item{workers}{Number of worker processes when `use_parallel = TRUE`.}

\item{reuse_existing}{If TRUE, skip conditions with existing output files.}

\item{verbose}{Verbose messages.}

\item{fp_variance_tbl}{Optional footprint variance table (peak_ID + mean_raw/var_raw/rsd).}

\item{rna_variance_tbl}{Optional RNA variance table (ensembl_gene_id/HGNC + mean_raw/var_raw/rsd).}
}
\description{
Build per-condition TF->gene link tables ("lighting") using a chosen sample label column.
}
