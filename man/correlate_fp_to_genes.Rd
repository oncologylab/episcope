% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils_step2_connect_tf_genes.R
\name{correlate_fp_to_genes}
\alias{correlate_fp_to_genes}
\title{Correlate fp_peak scores to target-gene RNA for ATAC->gene pairs}
\usage{
correlate_fp_to_genes(
  grn_set,
  atac_gene_corr_kept = NULL,
  gh_tbl = NULL,
  gh_cols = list(chrom = "chrom", start = "start", end = "end", gene = "connected_gene",
    id = NULL, conf = NULL),
  gene_mode = c("both", "ensembl", "hgnc"),
  fp_score_tbl = NULL,
  rna_tbl = NULL,
  fdr = 0.05,
  r_abs_min = 0.3,
  keep_pos = FALSE,
  method = c("pearson", "spearman", "kendall"),
  workers = max(1L, round(parallel::detectCores(logical = TRUE)/2)),
  cache_dir = NULL,
  cache_tag = NULL,
  cache_chunk_size = 50000L,
  cache_resume = TRUE,
  cache_verbose = FALSE,
  add_tf_rna_corr = FALSE
)
}
\arguments{
\item{grn_set}{List containing at least `fp_annotation` and (by default)
`fp_score` and `rna` unless overridden by `fp_score_tbl` / `rna_tbl`.}

\item{atac_gene_corr_kept}{Optional data frame with at least `atac_peak` and
`gene_key`. If NULL, `gh_tbl` is used to derive peak->gene pairs.}

\item{gh_tbl}{Optional enhancer->gene table (e.g., GeneHancer). If
`atac_gene_corr_kept` is NULL, overlaps are computed between `gh_tbl` and
the ATAC peaks referenced in `grn_set$fp_annotation`.}

\item{gh_cols}{Named list mapping columns in `gh_tbl`:
list(chrom="chrom", start="start", end="end", gene="connected_gene",
id=NULL, conf=NULL).}

\item{gene_mode}{Which gene IDs to retain from RNA when building GH pairs:
"both", "ensembl", or "hgnc".}

\item{fp_score_tbl}{Optional FP score table (peak_ID + samples). Defaults to
`grn_set$fp_score`.}

\item{rna_tbl}{Optional RNA table (ensembl_gene_id/HGNC + samples). Defaults
to `grn_set$rna`.}

\item{fdr}{FDR cutoff applied to FP->gene BH-adjusted p-values.}

\item{r_abs_min}{Minimum absolute correlation for FP->gene.}

\item{keep_pos}{If TRUE, keep only positive FP->gene correlations.}

\item{method}{Correlation method.}

\item{workers}{Number of parallel workers (future).}

\item{cache_dir}{Optional cache directory for FP->gene correlations.}

\item{cache_tag}{Cache tag (subfolder name) under cache_dir.}

\item{cache_chunk_size}{Chunk size for cached FP->gene computations.}

\item{cache_resume}{Resume from cache index if TRUE.}

\item{cache_verbose}{Verbosity for cache operations.}

\item{add_tf_rna_corr}{If TRUE, compute TF RNA -> target gene RNA correlations
and add r_rna, p_rna, p_adj_rna columns to outputs.}
}
\value{
List with:
  - fp_gene_corr_kept: filtered FP->gene correlations (+ optional TF->gene RNA corr cols)
  - fp_gene_corr_full: all FP->gene correlations (+ optional TF->gene RNA corr cols)
}
\description{
This function correlates footprint peak (fp_peak) scores to target-gene RNA
for ATAC->gene pairs, with optional disk caching for the FP->gene correlations.
}
\details{
Update (2025-12-16):
- Adds optional TF RNA expression -> target-gene RNA expression correlations
  (per unique tfs x gene_key) and joins results back onto both outputs as:
  r_rna, p_rna, p_adj_rna.
- Existing FP->gene correlation logic, filtering, and caching behavior are unchanged.
}
